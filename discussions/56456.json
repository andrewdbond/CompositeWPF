[
  {
    "Id": "190801",
    "ThreadId": "56456",
    "Html": "<p>hi,</p>\r\n<p>&nbsp;I am able to setup CompositeWPF&nbsp;and run the shell, but there is no region manager associated with it!</p>\r\n<p>I am initilising and running the Bootstrapper from within a Console app, but the value of</p>\r\n<p><span style=\"color:#0000ff;font-size:x-small\"><span style=\"color:#0000ff;font-size:x-small\">Dim</span></span><span style=\"font-size:x-small\"> RegionManager </span><span style=\"color:#0000ff;font-size:x-small\"><span style=\"color:#0000ff;font-size:x-small\">As</span></span><span style=\"font-size:x-small\"> RegionManager = </span><span style=\"color:#0000ff;font-size:x-small\"><span style=\"color:#0000ff;font-size:x-small\">Me</span></span><span style=\"font-size:x-small\">.GetValue(RegionManager.RegionManagerProperty)</span></p>\r\n<p><span style=\"font-size:x-small\">On the shell the DependancyProperty&nbsp;is &quot;nothing&quot; :(</span></p>\r\n<p><span style=\"font-size:x-small\">I have the full source for TfsDynamicPolicy available on <a href=\"http://cid-57599e234f1ebc1c.skydrive.live.com/browse.aspx/.Public/Projects\">http://cid-57599e234f1ebc1c.skydrive.live.com/browse.aspx/.Public/Projects</a>, but I have been at this for Ages... I had everything working when I was just using Unity, but I seam to be having an DependancyProperty problem...</span></p>\r\n<p><span style=\"font-size:x-small\">I can confirm that it is running the SetRegionManager finction</span></p>\r\n<table style=\"margin-bottom:0px\" border=0 cellspacing=0 cellpadding=0 width=\"100%\">\r\n<tbody>\r\n<tr>\r\n<td style=\"padding-bottom:4px;padding-left:5px;padding-right:5px;padding-top:4px\" colspan=2 valign=top>\r\n<pre><span style=\"color:#1000a0\">Public</span> <span style=\"color:#1000a0\">Shared</span> <span style=\"color:#1000a0\">Sub</span> <strong><a href=\"http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://Microsoft.Practices.Composite.Presentation:2.0.0.0/Microsoft.Practices.Composite.Presentation.Regions.RegionManager/SetRegionManager(System.Windows.DependencyObject,Microsoft.Practices.Composite.Regions.IRegionManager)\">SetRegionManager</a></strong>(<span style=\"color:#1000a0\">ByVal</span> <strong>target</strong><span style=\"color:#1000a0\"> As </span><a title=System.Windows.DependencyObject href=\"http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://WindowsBase:3.0.0.0:31bf3856ad364e35/System.Windows.DependencyObject\">DependencyObject</a>, <span style=\"color:#1000a0\">ByVal</span> <strong>value</strong><span style=\"color:#1000a0\"> As </span><a title=Microsoft.Practices.Composite.Regions.IRegionManager href=\"http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://Microsoft.Practices.Composite:2.0.0.0/Microsoft.Practices.Composite.Regions.IRegionManager\">IRegionManager</a>)\r\n    <a title=\"ByVal target As DependencyObject '' Parameter\">target</a>.<a title=\"System.Windows.DependencyObject.SetValue(ByVal DependencyProperty, ByVal Object)\" href=\"http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://WindowsBase:3.0.0.0:31bf3856ad364e35/System.Windows.DependencyObject/SetValue(System.Windows.DependencyProperty,Object)\">SetValue</a>(<a title=Microsoft.Practices.Composite.Presentation.Regions.RegionManager href=\"http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://Microsoft.Practices.Composite.Presentation:2.0.0.0/Microsoft.Practices.Composite.Presentation.Regions.RegionManager\">RegionManager</a>.<a title=\"RegionManagerProperty As DependencyProperty\" href=\"http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://Microsoft.Practices.Composite.Presentation:2.0.0.0/Microsoft.Practices.Composite.Presentation.Regions.RegionManager/RegionManagerProperty:System.Windows.DependencyProperty\">RegionManagerProperty</a>, <a title=\"ByVal value As IRegionManager '' Parameter\">value</a>)\r\n<span style=\"color:#1000a0\">End Sub</span>\r\n</pre>\r\n</td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n<p>&nbsp;</p>",
    "PostedDate": "2009-05-15T09:43:27.13-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "190893",
    "ThreadId": "56456",
    "Html": "<p style=\"margin:0cm 0cm 0pt\"><span style=\"\" lang=EN-US><span style=\"font-size:small\"><span style=\"font-family:Calibri\">Hi Martin,</span></span></span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"\" lang=EN-US><span style=\"font-size:small;font-family:Calibri\">&nbsp;</span></span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"\" lang=EN-US><span style=\"font-size:small\"><span style=\"font-family:Calibri\">Having taken a look at your code I found that the Shell you are resolving in the <strong>Edit</strong>() method of the <strong>TfsDynamicCheckInPolicy</strong> class is not the same as the one you create in the <strong>Bootstrapper </strong>(checking each HashCode). This is because the Shell is not registered in the container, but resolved instead.</span></span></span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"\" lang=EN-US><span style=\"font-size:small;font-family:Calibri\">&nbsp;</span></span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"\" lang=EN-US><span style=\"font-size:small\"><span style=\"font-family:Calibri\">To get the same instance I used the following code to register the shell in the unity container:</span></span></span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><strong><span style=\"text-decoration:underline\"><span style=\"\" lang=EN-US><span style=\"font-size:small\"><span style=\"font-family:Calibri\">Bootstrapper.vb</span></span></span></span></strong></p>\r\n<p style=\"margin:0cm 0cm 0pt;text-indent:35.4pt\"><span style=\"font-size:10pt;font-family:'Courier New'\" lang=EN-US>Protected Overrides Function CreateShell() As System.Windows.DependencyObject</span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\" lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim window As Shell = My.Unity.Resolve(Of Shell)()</span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\" lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; My.Unity.RegisterInstance(GetType(Shell), window)</span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\" lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return window1</span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\" lang=EN-US>End Function</span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"font-size:small\"><span style=\"font-family:Calibri\"><strong><span style=\"text-decoration:underline\"><span style=\"\" lang=EN-US>TfsDynamicCheckInPolicy.vb</span></span></strong><span style=\"text-decoration:underline\"><span style=\"font-size:10pt;font-family:'Courier New'\" lang=EN-US></span></span></span></span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\" lang=EN-US>Public Function Edit(ByVal policyEditArgs As Microsoft.TeamFoundation.VersionControl.Client.IPolicyEditArgs) As Boolean Implements Microsoft.TeamFoundation.VersionControl.Client.IPolicyDefinition.Edit</span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\" lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim window As Shell = My.Unity.Resolve(Of Shell)(<span style=\"color:#1f497d\">)</span></span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\" lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If window.ShowDialog Then</span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\" lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' Use Values</span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\" lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; m_Data = My.Unity.Resolve(Of DynamicPolicyEngine)().Data</span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\" lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return True</span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\" lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If</span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\" lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return False</span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\" lang=EN-US>&nbsp;&nbsp;&nbsp; End Function</span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"\" lang=EN-US><span style=\"font-size:small;font-family:Calibri\">&nbsp;</span></span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"\" lang=EN-US><span style=\"font-size:small\"><span style=\"font-family:Calibri\">Although this made the DependencyPropery return a correct <strong>RegionManager</strong>, this <strong>RegionManager</strong> had no Regions registered. The reason is that to create a new region the following validation is performed:</span></span></span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\" lang=EN-US>private static void OnSetRegionNameCallback(DependencyObject element, DependencyPropertyChangedEventArgs args)</span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\" lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\" lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!IsInDesignMode(element))</span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\" lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\" lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CreateRegion(element);</span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\" lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\" lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\" lang=EN-US>&nbsp;</span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\" lang=EN-US>private static bool IsInDesignMode(DependencyObject element)</span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\" lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\" lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Due to a known issue in Cider, GetIsInDesignMode attached property value is not enough to know if it's in design mode.</span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\" lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return DesignerProperties.GetIsInDesignMode(element) || Application.Current == null</span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\" lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; || Application.Current.GetType() == typeof(Application);</span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\" lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"\" lang=EN-US><span style=\"font-size:small;font-family:Calibri\">&nbsp;</span></span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"\" lang=EN-US><span style=\"font-size:small\"><span style=\"font-family:Calibri\">The reason the region is never created is that the Application.Current is always null, because you are not creating an application. Have in mind that even if you modify that validation you could have other problems if you do not create an application.</span></span></span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"\" lang=EN-US><span style=\"font-size:small;font-family:Calibri\">&nbsp;</span></span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"\" lang=EN-US><span style=\"font-size:small\"><span style=\"font-family:Calibri\">Please let me know if this helps.</span></span></span></p>\r\n<p style=\"margin:0cm 0cm 0pt -0.6pt\"><span style=\"\" lang=EN-US><span style=\"font-size:small;font-family:Calibri\">&nbsp;</span></span></p>\r\n<p style=\"margin:0cm 0cm 0pt -0.6pt\"><span style=\"\" lang=EN-US><span style=\"font-size:small\"><span style=\"font-family:Calibri\">Damian Schenkelman</span></span></span></p>\r\n<p style=\"margin:0cm 0cm 0pt\"><span style=\"\" lang=EN-US><a href=\"http://blogs.southworks.net/dschenkelman\"><span style=\"font-size:small;color:#0000ff;font-family:Calibri\">http://blogs.southworks.net/dschenkelman</span></a></span></p>",
    "PostedDate": "2009-05-15T15:25:52.06-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "190912",
    "ThreadId": "56456",
    "Html": "<p>First, Thank you, thanks you! I spent hours looking at that and never thought... And I must aplogise for you having to look at my crappy VB code :), and that you had to make sense of my haistily typed and cryptic post...</p>\r\n<p>Regarding the Applicaiton.Current being nothing:</p>\r\n<p>Why is that? I am running it within a Console application? Does it have to be a WPF applicaiton object?</p>\r\n<p>The final TfsDynamicPolicy class will be created by Visual Studio 2005/2008/2010 so the applicaiton in that case will be it.</p>\r\n<p>&nbsp;</p>\r\n<p>Martin Hinshelwood</p>\r\n<p><a href=\"http://blog.hinshelwood.com\">http://blog.hinshelwood.com</a></p>\r\n<p>&nbsp;</p>",
    "PostedDate": "2009-05-15T16:30:05.707-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "190923",
    "ThreadId": "56456",
    "Html": "<p>There sems to be a couple of places that Application.Current is used. Can I sugest a way round this for those of use that are hosting WPF applications in an Application that is not a WPF application!</p>\r\n<p>For&nbsp;the&nbsp;DelegateCommand, CompositeCommand, DefaultDispatcher (unused) objects&nbsp;instead of using Applicaiton.Current.Dispatch you use Dispatcher.Current which amounts to the same thing, but has no dependancy on the Application.</p>\r\n<p>The IsInDesigneMode is a little more tricky, but can we asumb that in designe mode the UnityBootstrapper&nbsp;object is not involved? If so, can we not set&nbsp;a property on the RegionManager&nbsp;of IsDesigneMode or IsBootsrapper that negates this check?</p>\r\n<p>Just my&nbsp;2p worth...</p>\r\n<p>I will try out these changes and update if they worked...</p>\r\n<p>Martin Hinshelwood</p>\r\n<p><a href=\"http://blog.hinshelwood.com\">http://blog.hinshelwood.com</a>&nbsp;</p>\r\n<p>&nbsp;</p>",
    "PostedDate": "2009-05-15T17:45:06.817-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "196214",
    "ThreadId": "56456",
    "Html": "<p>Hi.</p>\r\n<p>Martin, I've also encountred this issue.&nbsp;</p>\r\n<p>I'm using Prism with WPF which is hosted on a Outlook Add-In, Yeah I know :S.</p>\r\n<p>And in this scenario as well Application.Current is absent.</p>\r\n<p>I've changed to code to use Dispatcher.Current and it seems to be wokring quite well for event dispatching.</p>\r\n<p>Haven't tried to rest.</p>\r\n<p>Hope that helps.</p>\r\n<p>Ariel</p>\r\n<p>&nbsp;</p>",
    "PostedDate": "2009-05-31T17:08:58.013-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "196301",
    "ThreadId": "56456",
    "Html": "<p>I have implemented the changes and found no problems so far... :)</p>",
    "PostedDate": "2009-06-01T01:03:14.34-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]