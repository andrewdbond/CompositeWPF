[
  {
    "Id": "268180",
    "ThreadId": "78367",
    "Html": "<div>\r\n<p>This is the first application that myself and a co-worker are developing using Prism and MVVM in Silverlight 3.0. I am working on a shell/framework for the project that will have a list of &quot;plugins&quot; that can be added to a &quot;workspace&quot;. Each &quot;plugin&quot; implements IWorkspacePlugin which for now looks like:</p>\r\n<pre><code><span><div style=\"color:Black;background-color:White\"><pre><span style=\"color:Blue\">public</span> <span style=\"color:Blue\">interface</span> IWorkspacePlugin\r\n{\r\n    <span style=\"color:Blue\">string</span> PluginName { <span style=\"color:Blue\">get</span>; <span style=\"color:Blue\">set</span>; }\r\n    <span style=\"color:Blue\">object</span> PluginView { <span style=\"color:Blue\">get</span>; <span style=\"color:Blue\">set</span>; }\r\n    <span style=\"color:Blue\">object</span> PluginSettingsView { <span style=\"color:Blue\">get</span>; <span style=\"color:Blue\">set</span>; }\r\n    DelegateCommand&lt;<span style=\"color:Blue\">object</span>&gt; ClosePluginCommand { <span style=\"color:Blue\">get</span>; <span style=\"color:Blue\">set</span>; }\r\n}\r\n</pre>\r\n</div>\r\n</span><span><br></span></code></pre>\r\n<p>The intent of &quot;PluginView&quot; is to store the plugin's view.</p>\r\n<p>I then have the region in a view where these plugins should be added. The region's view looks like the following (some things omitted for brevity):</p>\r\n<pre><code><span><div style=\"color:Black;background-color:White\"><pre><span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">ListBox</span> <span style=\"color:Red\">x:Name</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">ModuleListBox</span><span style=\"color:Black\">&quot;</span>\r\n             <span style=\"color:Red\">Grid.Row</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">1</span><span style=\"color:Black\">&quot;</span>\r\n             <span style=\"color:Red\">rgn:RegionManager.RegionName</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">Workspace</span><span style=\"color:Black\">&quot;</span>\r\n             <span style=\"color:Red\">Background</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">Yellow</span><span style=\"color:Black\">&quot;</span>\r\n             <span style=\"color:Red\">ItemsSource</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">{Binding Plugins}</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">&gt;</span>\r\n        <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">ListBox.ItemsPanel</span><span style=\"color:Blue\">&gt;</span>\r\n            <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">ItemsPanelTemplate</span><span style=\"color:Blue\">&gt;</span>\r\n                <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Canvas</span> <span style=\"color:Blue\">/&gt;</span>\r\n            <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">ItemsPanelTemplate</span><span style=\"color:Blue\">&gt;</span>\r\n        <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">ListBox.ItemsPanel</span><span style=\"color:Blue\">&gt;</span>\r\n        <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">ListBox.Template</span><span style=\"color:Blue\">&gt;</span>\r\n            <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">ControlTemplate</span><span style=\"color:Blue\">&gt;</span>\r\n                <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Grid</span> <span style=\"color:Red\">x:Name</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">ListBoxGrid</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">&gt;</span>\r\n                    <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">ItemsPresenter</span><span style=\"color:Blue\">&gt;</span><span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">ItemsPresenter</span><span style=\"color:Blue\">&gt;</span>\r\n                <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Grid</span><span style=\"color:Blue\">&gt;</span>\r\n            <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">ControlTemplate</span><span style=\"color:Blue\">&gt;</span>\r\n        <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">ListBox.Template</span><span style=\"color:Blue\">&gt;</span>\r\n        <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">ListBox.ItemTemplate</span><span style=\"color:Blue\">&gt;</span>\r\n            <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">DataTemplate</span><span style=\"color:Blue\">&gt;</span>\r\n                <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Border</span> <span style=\"color:Red\">BorderBrush</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">Black</span><span style=\"color:Black\">&quot;</span>\r\n                        <span style=\"color:Red\">BorderThickness</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">2</span><span style=\"color:Black\">&quot;</span>\r\n                        <span style=\"color:Red\">Margin</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">0</span><span style=\"color:Black\">&quot;</span>\r\n                        <span style=\"color:Red\">Padding</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">0</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">&gt;</span>\r\n                    <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Grid</span><span style=\"color:Blue\">&gt;</span>\r\n                        <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Grid.RowDefinitions</span><span style=\"color:Blue\">&gt;</span>\r\n                            <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">RowDefinition</span> <span style=\"color:Red\">Height</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">20</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">&gt;</span><span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">RowDefinition</span><span style=\"color:Blue\">&gt;</span>\r\n                            <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">RowDefinition</span> <span style=\"color:Red\">Height</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">*</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">&gt;</span><span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">RowDefinition</span><span style=\"color:Blue\">&gt;</span>\r\n                            <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">RowDefinition</span> <span style=\"color:Red\">Height</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">5</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">&gt;</span><span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">RowDefinition</span><span style=\"color:Blue\">&gt;</span>\r\n                        <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Grid.RowDefinitions</span><span style=\"color:Blue\">&gt;</span>\r\n                        <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Grid</span> <span style=\"color:Red\">Grid.Row</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">0</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">&gt;</span>\r\n                            <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Grid.ColumnDefinitions</span><span style=\"color:Blue\">&gt;</span>\r\n                                <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">ColumnDefinition</span> <span style=\"color:Red\">Width</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">*</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">&gt;</span><span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">ColumnDefinition</span><span style=\"color:Blue\">&gt;</span>\r\n                                <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">ColumnDefinition</span> <span style=\"color:Red\">Width</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">.05*</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">&gt;</span><span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">ColumnDefinition</span><span style=\"color:Blue\">&gt;</span>\r\n                            <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Grid.ColumnDefinitions</span><span style=\"color:Blue\">&gt;</span>\r\n                            <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Thumb</span> <span style=\"color:Red\">HorizontalAlignment</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">Stretch</span><span style=\"color:Black\">&quot;</span>\r\n                                   <span style=\"color:Red\">Background</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">Green</span><span style=\"color:Black\">&quot;</span>\r\n                                   <span style=\"color:Red\">DragDelta</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">Thumb_DragDelta</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">&gt;</span><span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Thumb</span><span style=\"color:Blue\">&gt;</span>\r\n                            <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Button</span> <span style=\"color:Red\">Content</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">X</span><span style=\"color:Black\">&quot;</span>\r\n                                    <span style=\"color:Red\">HorizontalAlignment</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">Right</span><span style=\"color:Black\">&quot;</span>\r\n                                    <span style=\"color:Red\">Grid.Column</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">1</span><span style=\"color:Black\">&quot;</span>\r\n                                    <span style=\"color:Red\">cmd:Click.Command</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">{Binding CloseViewCommand}</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">&gt;</span><span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Button</span><span style=\"color:Blue\">&gt;</span>\r\n                        <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Grid</span><span style=\"color:Blue\">&gt;</span>\r\n                        <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Border</span> <span style=\"color:Red\">BorderBrush</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">Black</span><span style=\"color:Black\">&quot;</span>\r\n                                <span style=\"color:Red\">BorderThickness</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">2</span><span style=\"color:Black\">&quot;</span>\r\n                                <span style=\"color:Red\">Margin</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">0</span><span style=\"color:Black\">&quot;</span>\r\n                                <span style=\"color:Red\">VerticalAlignment</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">Center</span><span style=\"color:Black\">&quot;</span>\r\n                                <span style=\"color:Red\">HorizontalAlignment</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">Center</span><span style=\"color:Black\">&quot;</span>\r\n                                <span style=\"color:Red\">Grid.Row</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">1</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">&gt;</span>\r\n                            <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">tk</span><span style=\"color:Blue\">:</span><span style=\"color:#A31515\">Viewbox</span> <span style=\"color:Red\">Stretch</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">Uniform</span><span style=\"color:Black\">&quot;</span>\r\n                                        <span style=\"color:Red\">StretchDirection</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">Both</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">&gt;</span>\r\n                                <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">ContentControl</span> <span style=\"color:Red\">Content</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">{Binding PluginView}</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">&gt;</span>  <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">ContentControl</span><span style=\"color:Blue\">&gt;</span>\r\n                            <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">tk</span><span style=\"color:Blue\">:</span><span style=\"color:#A31515\">Viewbox</span><span style=\"color:Blue\">&gt;</span>\r\n                        <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Border</span><span style=\"color:Blue\">&gt;</span>\r\n                        <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Thumb</span> <span style=\"color:Red\">x:Name</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">SizeGrip</span><span style=\"color:Black\">&quot;</span>\r\n                               <span style=\"color:Red\">Grid.Row</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">2</span><span style=\"color:Black\">&quot;</span>\r\n                               <span style=\"color:Red\">VerticalAlignment</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">Bottom</span><span style=\"color:Black\">&quot;</span>\r\n                               <span style=\"color:Red\">HorizontalAlignment</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">Right</span><span style=\"color:Black\">&quot;</span>\r\n                               <span style=\"color:Red\">Width</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">10</span><span style=\"color:Black\">&quot;</span>\r\n                               <span style=\"color:Red\">Height</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">10</span><span style=\"color:Black\">&quot;</span>\r\n                               <span style=\"color:Red\">Margin</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">0,0,-7,-7</span><span style=\"color:Black\">&quot;</span>\r\n                               <span style=\"color:Red\">Style</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">{StaticResource SizeGrip}</span><span style=\"color:Black\">&quot;</span>\r\n                               <span style=\"color:Red\">DragDelta</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">SizeGrip_DragDelta</span><span style=\"color:Black\">&quot;</span> <span style=\"color:Blue\">/&gt;</span>\r\n                    <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Grid</span><span style=\"color:Blue\">&gt;</span>\r\n                <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Border</span><span style=\"color:Blue\">&gt;</span>\r\n            <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">DataTemplate</span><span style=\"color:Blue\">&gt;</span>                \r\n        <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">ListBox.ItemTemplate</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">ListBox</span><span style=\"color:Blue\">&gt;</span>\r\n</pre>\r\n</div>\r\n</span><span><br></span></code></pre>\r\n<p>This &quot;WorkspaceView&quot; has a ViewModel that has a Plugins collection (IWorkspacePlugin) that the ListBox ItemsSource is bound to. All of this is done so that I can display a window around each plugin that has an &quot;X&quot; close button which should be bound to the IWorkspacePlugin's &quot;ClosePluginCommand&quot; property. The problem I am having is that I don't know how to get the plugin's view (IWorkspacePlugin.PluginView) injected where the ContentControl is in the ListBox.ItemTemplate through the binding &quot;PluginView&quot;. How do I do that? Am I going about this all the wrong way?</p>\r\n<p>Any guidance would be appreciated, thank you!</p>\r\n</div>",
    "PostedDate": "2009-12-16T13:38:42.24-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "268223",
    "ThreadId": "78367",
    "Html": "<p>One way of doing this (albeit with MEF/MVVM/WPF) is outlined in this <a title=article href=\"http://www.codeproject.com/KB/WPF/SoapBoxCorePinBallDemo.aspx\">article</a>. I'm not sure ResourceDictionary Importing is relvant to Prism/Silverlight (I don't use either), but maybe its worth taking a look.</p>\r\n<p>The magic happens mainly in the sample's app.xaml.cs as well as by defining his &quot;Views&quot; each as a ResourceDictionary that contain one DataTemplate with the type set to the relevant ViewModel. All of this comes together via when the composition step is finished (after which OnImportsSatisfied() gets called and the Imported ResourceDictionary objects each get added to the app's Resources).</p>\r\n<p>GL!</p>",
    "PostedDate": "2009-12-16T15:40:00.197-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "268588",
    "ThreadId": "78367",
    "Html": "<p>I have made some progress on this issue but I hit another road block along the way after thinking I had it solved. Here is where I'm at now:</p>\r\n<p>The plugins are registered with a WorkSpaceManager class during their particular PRISM IModule.Initialize() methods like so:</p>\r\n<pre><code><span><div style=\"color:Black;background-color:White\"><pre>workspace.RegisterPlugin(<span style=\"color:Blue\">new</span> PluginInfo() { Name = <span style=\"color:#A31515\">&quot;MyPlugin&quot;</span>, ViewType = <span style=\"color:Blue\">typeof</span>(MyPluginView), SettingsViewType = <span style=\"color:Blue\">null</span> });\r\n</pre>\r\n</div>\r\n</span><span></span><span><br></span></code></pre>\r\n<p>The RegisterPlugin() method simply adds the PluginInfo object to a dictionary keyed on the &quot;Name&quot; property. Then when I want to add a plugin to the workspace I do the following:</p>\r\n<pre><code><span><div style=\"color:Black;background-color:White\"><pre>workspace.AddPluginToWorkspace(<span style=\"color:#A31515\">&quot;MyPlugin&quot;</span>);\r\n</pre>\r\n</div>\r\n</span><span></span><span><br></span></code></pre>\r\n<p>The AddPluginToWorkspace method of the WorkspaceManager class looks like this:</p>\r\n<pre><code><span><div style=\"color:Black;background-color:White\"><pre><span style=\"color:Blue\">public</span> <span style=\"color:Blue\">void</span> AddPluginToWorkspace(<span style=\"color:Blue\">string</span> pluginName)\r\n    {\r\n        <span style=\"color:Blue\">if</span> (AvailablePlugins.ContainsKey(pluginName))\r\n        {\r\n            PluginInfo pi = AvailablePlugins[pluginName];\r\n            WorkspacePlugin wsp = <span style=\"color:Blue\">new</span> WorkspacePlugin();\r\n\r\n            <span style=\"color:Green\">// Create the View</span>\r\n            wsp.View = (Control)<span style=\"color:Blue\">this</span>.unityContainer.Resolve(pi.ViewType);\r\n            wsp.Name = pi.Name;\r\n\r\n            <span style=\"color:Green\">// Wire up the CloseCommand to WorkspaceManager's PluginClosing handler</span>\r\n            wsp.CloseCommand = <span style=\"color:Blue\">new</span> DelegateCommand&lt;WorkspacePlugin&gt;(<span style=\"color:Blue\">this</span>.PluginClosing);\r\n\r\n            <span style=\"color:Green\">// Add the plugin to the active plugins (modules) collection</span>\r\n            <span style=\"color:Blue\">this</span>.modules.Add(wsp);\r\n\r\n            <span style=\"color:Green\">// FIX: This should notify anyone listening that the ActivePlugins have changed. When enabled, this causes the same error that will be mentioned further on when attempting to close a plugin.</span>\r\n            <span style=\"color:Green\">//this.eventAggregator.GetEvent&lt;ActivePluginsChanged&gt;().Publish(wsp);</span>\r\n        }\r\n\r\n    }\r\n</pre>\r\n</div>\r\n</span><span></span><span><br></span></code></pre>\r\n<p>The Workspace ViewModel simply exposes the WorkspaceManager Service's modules collection which is the datacontext of the Workspace View as shown here:</p>\r\n<pre><code><span><div style=\"color:Black;background-color:White\"><pre><span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Grid</span> <span style=\"color:Red\">x:Name</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">LayoutRoot</span><span style=\"color:Black\">&quot;</span>\r\n      <span style=\"color:Red\">Background</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">White</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">ListBox</span> <span style=\"color:Red\">x:Name</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">ModuleListBox</span><span style=\"color:Black\">&quot;</span>\r\n             <span style=\"color:Red\">Grid.Row</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">1</span><span style=\"color:Black\">&quot;</span>\r\n             <span style=\"color:Red\">rgn:RegionManager.RegionName</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">Workspace</span><span style=\"color:Black\">&quot;</span>\r\n             <span style=\"color:Red\">Background</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">Yellow</span><span style=\"color:Black\">&quot;</span>\r\n             <span style=\"color:Red\">ItemsSource</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">{Binding Plugins}</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">&gt;</span>\r\n        <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">ListBox.ItemsPanel</span><span style=\"color:Blue\">&gt;</span>\r\n            <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">ItemsPanelTemplate</span><span style=\"color:Blue\">&gt;</span>\r\n                <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Canvas</span> <span style=\"color:Blue\">/&gt;</span>\r\n            <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">ItemsPanelTemplate</span><span style=\"color:Blue\">&gt;</span>\r\n        <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">ListBox.ItemsPanel</span><span style=\"color:Blue\">&gt;</span>\r\n        <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">ListBox.Template</span><span style=\"color:Blue\">&gt;</span>\r\n            <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">ControlTemplate</span><span style=\"color:Blue\">&gt;</span>\r\n                <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Grid</span> <span style=\"color:Red\">x:Name</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">ListBoxGrid</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">&gt;</span>\r\n                    <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">ItemsPresenter</span><span style=\"color:Blue\">&gt;</span><span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">ItemsPresenter</span><span style=\"color:Blue\">&gt;</span>\r\n                <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Grid</span><span style=\"color:Blue\">&gt;</span>\r\n            <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">ControlTemplate</span><span style=\"color:Blue\">&gt;</span>\r\n        <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">ListBox.Template</span><span style=\"color:Blue\">&gt;</span>\r\n        <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">ListBox.ItemTemplate</span><span style=\"color:Blue\">&gt;</span>\r\n            <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">DataTemplate</span><span style=\"color:Blue\">&gt;</span>\r\n                <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Border</span> <span style=\"color:Red\">BorderBrush</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">Black</span><span style=\"color:Black\">&quot;</span>\r\n                        <span style=\"color:Red\">BorderThickness</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">2</span><span style=\"color:Black\">&quot;</span>\r\n                        <span style=\"color:Red\">Margin</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">0</span><span style=\"color:Black\">&quot;</span>\r\n                        <span style=\"color:Red\">Padding</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">0</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">&gt;</span>\r\n                    <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Grid</span><span style=\"color:Blue\">&gt;</span>\r\n                        <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Grid.RowDefinitions</span><span style=\"color:Blue\">&gt;</span>\r\n                            <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">RowDefinition</span> <span style=\"color:Red\">Height</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">20</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">&gt;</span><span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">RowDefinition</span><span style=\"color:Blue\">&gt;</span>\r\n                            <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">RowDefinition</span> <span style=\"color:Red\">Height</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">*</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">&gt;</span><span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">RowDefinition</span><span style=\"color:Blue\">&gt;</span>\r\n                            <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">RowDefinition</span> <span style=\"color:Red\">Height</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">5</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">&gt;</span><span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">RowDefinition</span><span style=\"color:Blue\">&gt;</span>\r\n                        <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Grid.RowDefinitions</span><span style=\"color:Blue\">&gt;</span>\r\n                        <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Grid</span> <span style=\"color:Red\">Grid.Row</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">0</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">&gt;</span>\r\n                            <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Grid.ColumnDefinitions</span><span style=\"color:Blue\">&gt;</span>\r\n                                <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">ColumnDefinition</span> <span style=\"color:Red\">Width</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">*</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">&gt;</span><span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">ColumnDefinition</span><span style=\"color:Blue\">&gt;</span>\r\n                                <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">ColumnDefinition</span> <span style=\"color:Red\">Width</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">.05*</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">&gt;</span><span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">ColumnDefinition</span><span style=\"color:Blue\">&gt;</span>\r\n                            <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Grid.ColumnDefinitions</span><span style=\"color:Blue\">&gt;</span>\r\n                            <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Button</span> <span style=\"color:Red\">Content</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">X</span><span style=\"color:Black\">&quot;</span>\r\n                                    <span style=\"color:Red\">HorizontalAlignment</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">Right</span><span style=\"color:Black\">&quot;</span>\r\n                                    <span style=\"color:Red\">Grid.Column</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">1</span><span style=\"color:Black\">&quot;</span>\r\n                                    <span style=\"color:Red\">cmd:Click.Command</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">{Binding CloseCommand}</span><span style=\"color:Black\">&quot;</span>\r\n                                    <span style=\"color:Red\">cmd:Click.CommandParameter</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">{Binding}</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">&gt;</span><span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Button</span><span style=\"color:Blue\">&gt;</span>\r\n                        <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Grid</span><span style=\"color:Blue\">&gt;</span>\r\n                        <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Border</span> <span style=\"color:Red\">BorderBrush</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">Black</span><span style=\"color:Black\">&quot;</span>\r\n                                <span style=\"color:Red\">BorderThickness</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">2</span><span style=\"color:Black\">&quot;</span>\r\n                                <span style=\"color:Red\">Margin</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">0</span><span style=\"color:Black\">&quot;</span>\r\n                                <span style=\"color:Red\">VerticalAlignment</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">Center</span><span style=\"color:Black\">&quot;</span>\r\n                                <span style=\"color:Red\">HorizontalAlignment</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">Center</span><span style=\"color:Black\">&quot;</span>\r\n                                <span style=\"color:Red\">Grid.Row</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">1</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">&gt;</span>\r\n                            <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">tk</span><span style=\"color:Blue\">:</span><span style=\"color:#A31515\">Viewbox</span> <span style=\"color:Red\">Stretch</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">Uniform</span><span style=\"color:Black\">&quot;</span>\r\n                                        <span style=\"color:Red\">StretchDirection</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">Both</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">&gt;</span>\r\n                                <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">ContentControl</span> <span style=\"color:Red\">Content</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">{Binding View}</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">&gt;</span><span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">ContentControl</span><span style=\"color:Blue\">&gt;</span>                    \r\n                            <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">tk</span><span style=\"color:Blue\">:</span><span style=\"color:#A31515\">Viewbox</span><span style=\"color:Blue\">&gt;</span>\r\n                        <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Border</span><span style=\"color:Blue\">&gt;</span>                            \r\n                    <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Grid</span><span style=\"color:Blue\">&gt;</span>\r\n                <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Border</span><span style=\"color:Blue\">&gt;</span>\r\n            <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">DataTemplate</span><span style=\"color:Blue\">&gt;</span>\r\n        <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">ListBox.ItemTemplate</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">ListBox</span><span style=\"color:Blue\">&gt;</span>\r\n<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Grid</span><span style=\"color:Blue\">&gt;</span>\r\n</pre>\r\n</div>\r\n</span><span></span><span><br></span></code></pre>\r\n<p><strong>Notice the Content control that is bound to the &quot;View&quot; property of the WorkspacePlugin and the Button that has the Click.Command bound to the &quot;CloseCommand&quot;.</strong> This is where I was stuck initially but for the most part, this works. The plugin's view is loaded inside the other controls and I'm still able to bind the close command (And other commands to be added at a later time) to an underlying model.</p>\r\n<p><strong>The problem now</strong> is that whenever I click the close button and the WorkspacePlugin is removed from the modules collection, a property changed event is fired on the ViewModel to let the listbox know to update I get the following error (This also happens if I uncomment the line below the &quot;FIX&quot; comment above:</p>\r\n<blockquote>\r\n<p>System.ArgumentException: Value does not fall within the expected range. at MS.Internal.XcpImports.CheckHResult(UInt32 hr) at MS.Internal.XcpImports.SetValue(INativeCoreTypeWrapper obj, DependencyProperty property, DependencyObject doh) at MS.Internal.XcpImports.SetValue(INativeCoreTypeWrapper doh, DependencyProperty property, Object obj) at System.Windows.DependencyObject.SetObjectValueToCore(DependencyProperty dp, Object value) at System.Windows.DependencyObject.RefreshExpression(DependencyProperty dp) at System.Windows.Data.BindingExpression.RefreshExpression() at System.Windows.Data.BindingExpression.SendDataToTarget() at System.Windows.Data.BindingExpression.SourceAquired() at System.Windows.Data.BindingExpression.DataContextChanged(Object o, DataContextChangedEventArgs e) at System.Windows.FrameworkElement.OnDataContextChanged(DataContextChangedEventArgs e) at System.Windows.FrameworkElement.OnTreeParentUpdated(DependencyObject newParent, Boolean bIsNewParentAlive) at System.Windows.DependencyObject.UpdateTreeParent(IManagedPeer oldParent, IManagedPeer newParent, Boolean bIsNewParentAlive, Boolean keepReferenceToParent) at MS.Internal.FrameworkCallbacks.ManagedPeerTreeUpdate(IntPtr oldParentElement, IntPtr parentElement, IntPtr childElement, Byte bIsParentAlive, Byte bKeepReferenceToParent)</p>\r\n</blockquote>\r\n<p>From what I gather by looking online, this typically means that a visual element that was already added to the visual tree is trying to be added again. This kind of makes since if I only have 1 plugin displayed and close it, it disappears and there is no error. I am fairly certain that the error is due to the WorkspacePlugin.View property being a visual control and the binding update is attempting to re-add it to the visual tree.</p>\r\n<p>How can I work around this or achieve the desired result without the error message?</p>",
    "PostedDate": "2009-12-17T11:35:39.783-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]