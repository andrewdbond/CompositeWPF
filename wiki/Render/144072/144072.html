<div class="wikidoc"><h1>Fix: CAL Build failure with Silverlight GDR update</h1>
The recent update of Silverlight from version <i>2.0.31005.0</i> to version <i>2.0.40115.00 (GDR1)</i> causes the <b>Composite.Silverlight.Tests</b> project to stop building successfully.<br /><br />This affects the test project only, but you can still build the <i>Composite Application Library</i> (CAL) and reference it from an application.<br /><br />The reason is that there is a batch file being executed as a pre-build event that is trying to locate the Silverlight assemblies using the specific assembly version in the file path.<br /><br />The batch file is called <b>createXap.bat</b> and is located at <b>&quot;%sourcedir%\CAL\Silverlight\Composite.Tests\Mocks\Modules&quot;</b>.<br />
<h2>How to fix it</h2>
<b>Option 1:</b>  The <a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=fa07e1ce-ca3f-4b9b-a21b-e3fa10d013dd&amp;DisplayLang=en">MSDN release</a> has been update to correct this problem.  Download the latest source code from the download page.<br /><br /><b>Option 2:</b>  Replace the batch file with the one avaliable for download below, or you can modify the following line in the script:<br /><pre>
set silverlightDll=&quot;%ProgramFiles%\Microsoft Silverlight\2.0.31005.0\mscorlib.dll&quot;
</pre><br />With:<br /><pre>
set silverlightDll=&quot;%ProgramFiles%\Microsoft SDKs\Silverlight\v2.0\Reference Assemblies\mscorlib.dll&quot;
</pre><br /><br />This will grab the DLLs from the Silverlight SDK installation path, which is where Visual Studio looks for the assemblies when building the Silverlight projects.<br /><br />Note: The file download contains this fix and also improved error checking and build output comments to better understand the flow of the script, so replacing the entire batch file is advised.<br />
<h2>More information</h2>The createXap.bat file is needed because there is a test case that needs a dynamically generated XAP file stream. This batch file runs on the pre-build event of the test project and manually creates a XAP file to be included as a resource in the test assembly DLL. We are using a pre-build event because CodeDom is not available on the Silverlight CLR, so the assembly must be generated before the test cases are built and start running.<br />The test case that needs a XAP content resource stream is XapModuleTypeLoaderFixture.ShouldLoadDownloadedAssemblies.<br />
<h2>Download</h2>Download the fixed <a href=".\1b5a518b-4ef4-4297-8b01-421493692679">createXap.bat</a> file and replace it in <b>&quot;%sourcedir%\CAL\Silverlight\Composite.Tests\Mocks\Modules&quot;</b>.</div><div class="ClearBoth"></div>